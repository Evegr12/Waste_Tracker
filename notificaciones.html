<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="notificaciones.css">
    <title>Waste Tracker - Notificaciones</title>
</head>
<body>
    <header>
        <div class="logo">
            <a href="inicioRestaurante.html">
                <img src="logoWT.png" alt="Waste Tracker">
            </a>
            <h1>Waste Tracker</h1>
        </div>
        <nav>
            <a href="notificaciones.html"><img src="notificaciones.png" alt="Notificaciones"></a>
            <a href="historial.html"><img src="historial-icon.png" alt="Historial"></a>
            <a href="perfilRestaurante.html"><img src="perfil-icon.png" alt="Perfil"></a>
        </nav>
    </header>

    <main>
        <div class="notifications">
            <h2>Notificaciones</h2>
            <!-- Aquí se agregarán las notificaciones dinámicamente -->
        </div>
    </main>

    <footer>
        <nav class="footer-nav">
            <a href="inicioRestaurante.html"><img src="home-icon.png" alt="Inicio"></a>
            <a href="solicitudRecoleccion.html"><img src="bote-icon.png" alt="Bote"></a>
            <a href="calificaciones.html"><img src="calif-icon.png" alt="Calificar"></a>
        </nav>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const notificacion = localStorage.getItem('notificacionRecoleccion');
            if (notificacion) {
                mostrarNotificacion(notificacion);  // Mostrar la notificación almacenada
            } else {
                console.log('No hay notificaciones nuevas');
            }
        });

        function mostrarNotificacionesAcciones(mensajes) {
            const notificationContainer = document.querySelector('.notifications');
            mensajes.forEach(mensaje => {
                const notificationItem = document.createElement('div');
                notificationItem.classList.add('notification');
                notificationItem.innerHTML = `
                <p class="message">${mensaje.texto}</p>
                <div class="datetime">
                    <span class="date">Fecha no especificada</span>
                    <span class="time">Hora no especificada</span>
                </div>
                `;
                notificationContainer.appendChild(notificationItem);
            });
            }

        function obtenerMensajesRecoleccion() {
            fetch('/mensajes-recoleccion', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    mostrarNotificacionesAcciones(data.mensajes);
                } else {
                    console.error('Error en el servidor:', data.error);
                }
            })
            .catch(error => console.error('Error fetching mensajes de recolección:', error));
        }

        function mostrarNotificacionConsejo(consejo) {
            const consejoContainer = document.querySelector('.consejo-notification');
            consejoContainer.innerHTML = `
                <div class="notification">
                <p class="message">${consejo}</p>
                </div>
            `;
            }

        function obtenerConsejoAleatorio() {
            fetch('/notificacion-consejo', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                mostrarNotificacionConsejo(data.consejo);
                } else {
                console.error('Error en el servidor:', data.error);
                }
            })
            .catch(error => console.error('Error fetching consejo:', error));
        }

        // Llamar al obtener consejos al iniciar sesión o al cargar la página
        obtenerConsejoAleatorio();

        // Llamar a obtener notificaciones de acciones cuando el restaurante realiza una acción o necesita revisar sus notificaciones
        obtenerMensajesRecoleccion();
    </script>
</body>
</html>

